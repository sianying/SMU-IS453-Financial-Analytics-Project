
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="stylesheet" href="./assets/style.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

    <!-- Vue link -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

    <!-- SockietIO -->
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js" integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H" crossorigin="anonymous"></script>

</head>
<body v-on:load="ta(event, 'ta')">

    <div id="app" v-cloak>
        <div class = "container">
            <div class = "row py-4">
                <div class = "col-2">
                    <img height= "60px" width= "auto" src = "./assets/assure_logo.jpg">
                </div>
                <div class = "col-10">
                    Search for a fund: <select v-model="stockSelected" data-width="90%" id="stock-selection" class="selectpicker mt-1" data-live-search="true"data-max-options="1"></select>
                </div>
            </div>
            <div id="tabs-btn" class = "row">
                <div class = "col-2 border-right">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a id="ta-tab" class="nav-link active tablinks" aria-current="page" v-on:click = "ta('ta', $event)">Technical Analysis</a>
                        </li>
                        <li class="nav-item">
                            <a id="po-tab" class="nav-link tablinks" v-on:click = "po('po', $event)">Portfolio Optimization</a>
                        </li>
                        <li class="nav-item">
                            <a id="prediction-tab" class="nav-link tablinks" v-on:click = "prediction('prediction', $event)">Prediction</a>
                        </li>
                    </ul>
                </div>
                <div class = "col-9">
                    <div>  
                        <b>Selected fund: <span id="selected-stocks">{{stockSelected}}</span></b>
                    </div>

                    <!-- div for TA -->
                    <div id="ta" class="tabcontent my-3 align-items-center">
                        <!-- <div class="pr-2 pb-2">Select a Technical Analysis Tool: </div>
                        <div class="pl-1">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" v-model="selectedTA" id="returns" value="returns">
                                <label class="form-check-label" for="inlineCheckbox">Return Series</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="ema" v-model="selectedTA" value="ema">
                                <label class="form-check-label" for="inlineCheckbox1">Exponential Moving Average (EMA)</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="volatility" v-model="selectedTA" value="volatility">
                                <label class="form-check-label" for="inlineCheckbox2">Volatility Analysis</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="macd" v-model="selectedTA" value="macd">
                                <label class="form-check-label" for="inlineCheckbox4">Moving Average Convergence Divergence (MACD)</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" v-model="selectedTA" id="bollinger" value="bbands">
                                <label class="form-check-label" for="inlineCheckbox5">Bollinger Bands</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" v-model="selectedTA" id="rsi" value="rsi">
                                <label class="form-check-label" for="inlineCheckbox6">Relative Strength Index (RSI) </label>
                            </div>                            
                        </div> -->
                        <div id="graphs">
                                <div class="dropdown my-2">
                                    <span class="pr-3">Select a Technical Analysis Tool: </span>
                                    <select v-model="selectedTA" class="selectpicker" data-width="fit">
                                        <option value="returns">Return Series</option>
                                        <option value="ema">Exponential Moving Averages</option>
                                        <option value="volatility">Volatility</option>
                                        <option value="macd">Moving Average Convergence Divergence (MACD)</option>
                                        <option value="bollinger">Bollinger Bands</option>
                                    </select>
                                    
                                </div>
                                <div>
                                    <span class="pr-3">Time Range: 1 Year </span>
                                    <!-- <select v-model="timeRange" class="selectpicker" data-width="fit"> -->
                                        <!-- <option value=1>1M</option>
                                        <option value=3>3M</option>
                                        <option value=6>6M</option> -->
                                        <!-- <option value=12>1Y</option> -->
                                        <!-- <option value=60>5Y</option> -->
                                    <!-- </select> -->
                                    
                                </div>
                            <div class="d-flex justify-content-between"> 
                                <span class="pt-2">
                                    <span class="pr-3">Cick to Generate Charts: </span>
                                    <button id="generate" v-on:click="setTickersData()" class="btn generate-btn">Generate Charts</button>
                                </span>
                                <span class="text-justify" style="width: 400px; display: inline-block" id ="description"></span>
                            </div>
                        </div>

                        <div width="200px" class="mt-3">
                            <canvas v-if="selectedTA == 'returns'" id="returnsGraph" style="width: 300px"></canvas>
                            <canvas v-if="selectedTA == 'ema'"id="emaGraph" style="width: 300px"></canvas>
                            <canvas v-if="selectedTA == 'volatility'"id="volatilityGraph" style="width: 300px"></canvas>
                            <canvas v-if="selectedTA == 'macd'"id="macdGraph" style="width: 300px"></canvas>
                            <canvas v-if="selectedTA == 'bollinger'"id="bollingerGraph" style="width: 300px"></canvas>
                        </div>
                    </div> 

                    <!-- div for PO -->
                    <div id="po" class="tabcontent" style="display: none">
                    </div>

                    <!-- div for prediction -->
                    <div id="prediction" class="tabcontent" style="display: none">

                    </div>
                </div>  
            </div>
            <div class = "row">
                <div class = "col-2"></div>
                <div class = "col-9"></div>
            </div>
        </div>
        

    </div>

</body>
</html>

<script type="module">
    import { URL, set_ticker_data, get_return_series, get_ema, get_volatility, get_macd, get_bollinger} from "./callAPI/endpoint.js";
    
    // for loading of stocks for dropdown

    d3.csv('./assets/nasdaq_etfs.csv')
    .then(addStock);

    function addStock(funds){
        for (let i = 0; i < funds.length; i++) {
            if(i == 0){ 
                let select = document.getElementById('stock-selection');
                let option = document.createElement('option');
                option.setAttribute('value', funds[i]['Name & Symbol']);
                option.setAttribute('selected', funds[i]['Name & Symbol']);
                option.appendChild(document.createTextNode(funds[i]['Name & Symbol']));
                select.appendChild(option);
            } else{
                let select = document.getElementById('stock-selection');
                let option = document.createElement('option');
                option.setAttribute('value', funds[i]['Name & Symbol']);
                option.appendChild(document.createTextNode(funds[i]['Name & Symbol']));
                select.appendChild(option);
            }
        }
    }

    // const socket = io.connect('http://127.0.0.1:5100');
    // for updating selected stocks 

    var app = new Vue({
            el: '#app',
            data: {
                stockSelected: "PSL - Invesco DWA Consumer Staples Momentum ETF",
                selectedTA: "returns",
                timeRange: 12
            },
            methods:{
            
                getTime: function(e){
                    let buttonValue = e.target.value;
                    this.timeRange = buttonValue;
                },

                setTickersData: function(){

                    document.getElementById("description").innerText = ""

                    const data = {
                        "data": this.stockSelected, 
                        "time_period": this.timeRange
                    };

                    set_ticker_data(URL, data).then(result =>{
                        if(this.selectedTA == "returns"){
                            this.generateReturnsGraph();
                        } else if(this.selectedTA == "ema"){
                            this.generateEMAGraph();
                        } else if(this.selectedTA == "volatility"){
                            this.generateVolatilityGraph();
                        } else if(this.selectedTA == "macd"){
                            this.generateMACDGraph();
                        } else if(this.selectedTA == "bollinger"){
                            this.generateBollingerGraph();
                        }
                    })

                },

                generateReturnsGraph: function(){

                    document.getElementById("description").innerText = ""

                    get_return_series(URL).then(result =>{
                        const data = result;

                        var returns_graph = document.getElementById("returnsGraph").getContext("2d");
                        if(window.bar != undefined){
                            window.bar.destroy(); 
                        } 

                        window.bar = new Chart("returnsGraph", {
                            type: "line",
                            data: data,
                            options: {
                                scales: {
                                    yAxes: [{
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Returns'
                                        }
                                    }],
                                    xAxes: [{
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Date'
                                        }
                                    }]
                                }
                            }
                        });
                    })                  
                },
                generateEMAGraph: function(){

                    document.getElementById("description").innerText = ""

                    get_ema(URL).then(result =>{
                        const data = result;

                    var ema_graph = document.getElementById("emaGraph").getContext("2d");
                    if(window.bar != undefined){
                        window.bar.destroy(); 
                    } 

                        window.bar = new Chart("emaGraph", {

                            type: "line",
                            data: data,
                            options: {
                                scales: {
                                    yAxes: [{
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Close Price'
                                        }
                                    }],
                                    xAxes: [{
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Date'
                                        }
                                    }]
                                }
                            }
                        });

                        document.getElementById("description").innerText = "When the shorter term EMA crosses above the longer term EMA, it is a buy signal. When the shorter term EMA crosses below the longer term EMA, it is a sell signal"
                    });

                    
                },
                generateVolatilityGraph: function(){
                    document.getElementById("description").innerText = ""

                    get_volatility(URL).then(result =>{
                        const data = result;

                    var volatility_graph = document.getElementById("volatilityGraph").getContext("2d");
                        if(window.bar != undefined){
                            window.bar.destroy(); 
                        } 
                    
                        window.bar = new Chart("volatilityGraph", {
                            data: data,
                            options: {
                                scales: {
                                    yAxes: [{
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Volatility'
                                        }
                                    }],
                                    xAxes: [{
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Date'
                                        }
                                    }]
                                }
                            }
                        });
                    
                    
                    })
                },
                generateMACDGraph: function(){


                    get_macd(URL).then(result =>{
                        const data = result;

                    var macd_graph = document.getElementById("macdGraph").getContext("2d");
                    if(window.bar != undefined){
                        window.bar.destroy(); 
                    } 

                    window.bar = new Chart("macdGraph", {
                        data: data,
                        options: {
                            scales: {
                                yAxes: [{
                                    // scaleLabel: {
                                    //     display: true,
                                    //     labelString: 'Close Price'
                                    // }
                                }],
                                xAxes: [{
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'Date'
                                    }
                                }]
                            }
                        }
                        });

                        document.getElementById("description").innerText = "When the MACD crosses above the MACD signal line, it is a buy signal. When the MACD crosses below the MACD signal line, it is a sell signal."
                    })
                    
                },
                generateBollingerGraph(){

                    document.getElementById("description").innerText = ""

                    get_bollinger(URL).then(result =>{
                        const data = result;

                    var macd_graph = document.getElementById("bollingerGraph").getContext("2d");
                    if(window.bar != undefined){
                        window.bar.destroy(); 
                    }
                    window.bar = new Chart("bollingerGraph", {
                        type: "line",
                        data: data,
                        options: {
                            scales: {
                                yAxes: [{
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'Close Price'
                                    }
                                }],
                                xAxes: [{
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'Date'
                                    }
                                }]
                            }
                        }
                        });
                    
                        document.getElementById("description").innerText = "When the close price touches the lower band, it indicates a buy signal (oversold scenario). When it touches the upper band, it indicates a sell signal (overbought scenario)"
                    })
                },
                // for switching of tabs

                ta: function (feature,evt) {
                    let taTab = document.getElementById("ta-tab");
                    taTab.className = "nav-link active";

                    let poTab = document.getElementById("po-tab");
                    poTab.className = "nav-link";

                    let predictionTab = document.getElementById("prediction-tab");
                    predictionTab.className = "nav-link";

                    var i, tabcontent, tablinks;
                    tabcontent = document.getElementsByClassName("tabcontent");
                    for (i = 0; i < tabcontent.length; i++) {
                        tabcontent[i].style.display = "none";
                    }
                    tablinks = document.getElementsByClassName("tablinks");
                    for (i = 0; i < tablinks.length; i++) {
                        tablinks[i].className = tablinks[i].className.replace("active", "");
                    }
                    document.getElementById(feature).style.display = "block";
                    evt.currentTarget.className += " active";
                    
                    // for chart generation
                },

            // ,po: function(feature,evt){
            //     let taTab = document.getElementById("ta-tab");
            //     taTab.className = "nav-link";

            //     let poTab = document.getElementById("po-tab");
            //     poTab.className = "nav-link active";

            //     let predictionTab = document.getElementById("prediction-tab");
            //     predictionTab.className = "nav-link";

            //     var i, tabcontent, tablinks;
            //     tabcontent = document.getElementsByClassName("tabcontent");
            //     for (i = 0; i < tabcontent.length; i++) {
            //         tabcontent[i].style.display = "none";
            //     }
            //     tablinks = document.getElementsByClassName("tablinks");
            //     for (i = 0; i < tablinks.length; i++) {
            //         tablinks[i].className = tablinks[i].className.replace("active", "");
            //     }
            //     document.getElementById(feature).style.display = "block";
            //     evt.currentTarget.className += " active";
            // },

            // prediction: function(feature,evt){
            //     let taTab = document.getElementById("ta-tab");
            //     taTab.className = "nav-link";

            //     let poTab = document.getElementById("po-tab");
            //     poTab.className = "nav-link";

            //     let predictionTab = document.getElementById("prediction-tab");
            //     predictionTab.className = "nav-link active";

            //     var i, tabcontent, tablinks;
            //     tabcontent = document.getElementsByClassName("tabcontent");
            //     for (i = 0; i < tabcontent.length; i++) {
            //         tabcontent[i].style.display = "none";
            //     }
            //     tablinks = document.getElementsByClassName("tablinks");
            //     for (i = 0; i < tablinks.length; i++) {
            //         tablinks[i].className = tablinks[i].className.replace("active", "");
            //     }
            //     document.getElementById(feature).style.display = "block";
            //     evt.currentTarget.className += " active";
            // }
        },
    })

</script>




